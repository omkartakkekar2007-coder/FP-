<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Milk Record</title>

  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:"Poppins",sans-serif;
    }
    body{
      background:#fdfdfd;
      min-height:100vh;
    }

    /* PROFILE BUTTON */
    .profile-btn{
      position: fixed;
      top: 20px;
      right:20px;
      width:45px;
      height:45px;
      background:#000;
      color:#fff;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 4px 15px rgba(0,0,0,0.2);
      transition:0.2s;
      z-index:999;
      user-select:none;
    }
    .profile-btn:hover{ transform:scale(1.06); }

    /* PROFILE POPUP (hidden by default) */
    .profile-popup{
      position:fixed;
      top:80px;
      right:20px;
      width:260px;
      background:linear-gradient(135deg,#4f46e5,#9333ea);
      color:#fff;
      padding:20px;
      border-radius:18px;
      box-shadow:0 10px 35px rgba(0,0,0,0.25);
      opacity:0;
      transform:translateY(-6px);
      pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      z-index:999;
    }

    /* visible state */
    .profile-popup.open{
      opacity:1;
      transform:translateY(0);
      pointer-events:auto;
    }

    @keyframes slideIn{
      from{opacity:0; transform:translateY(-10px);}
      to{opacity:1; transform:translateY(0);}
    }

    .profile-popup h2{ font-size:20px; margin-bottom:5px; }
    .profile-popup p{ font-size:14px; margin-bottom:8px; opacity:0.95; }

    .popup-btn{
      width:100%;
      margin-top:12px;
      padding:10px;
      background:rgba(255,255,255,0.95);
      border:none;
      border-radius:10px;
      font-size:14px;
      cursor:pointer;
      font-weight:600;
      color:#222;
    }
    .popup-btn:hover{ background:#fff; }

    .record-page{
      margin-top:120px;
      padding:20px;
      text-align:center;
    }

    /* small helper to show a debug hint (you can remove later) */
    .debug {
      position: fixed;
      left: 20px;
      bottom: 20px;
      background: #111;
      color: #fff;
      padding:6px 10px;
      border-radius:8px;
      font-size:12px;
      opacity:0.8;
      z-index:999;
    }
  </style>
</head>
<body>

  <!-- PROFILE BUTTON -->
  <div class="profile-btn" id="profileBtn" aria-label="Shop profile">P</div>

  <!-- PROFILE POPUP -->
  <div class="profile-popup" id="profilePopup" role="dialog" aria-hidden="true" aria-labelledby="shopName">
    <h2 id="shopName">Shop Name</h2>
    <p id="shopAddress">Address...</p>
    <p id="shopPhone">Phone...</p>

    <button class="popup-btn" id="btnHome">Home</button>
    <button class="popup-btn" id="btnLogout">Logout</button>
  </div>

  <!------------- MILK RECORD CONTENT ------------->
  <div class="record-page">
    <h1>Milk Record Page</h1>
    <p>Add your record table hereâ€¦</p>
  </div>

  <div class="debug" id="debug" style="display:none"></div>

  <script>
    (function () {
      // Elements
      const shopNameEl = document.getElementById('shopName');
      const shopAddressEl = document.getElementById('shopAddress');
      const shopPhoneEl = document.getElementById('shopPhone');
      const profileBtn = document.getElementById('profileBtn');
      const profilePopup = document.getElementById('profilePopup');
      const btnHome = document.getElementById('btnHome');
      const btnLogout = document.getElementById('btnLogout');
      const debugEl = document.getElementById('debug');

      // Helper: safe read from localStorage
      function getLS(key, fallback) {
        try {
          const v = localStorage.getItem(key);
          return (v === null || v === undefined) ? fallback : v;
        } catch (err) {
          console.error('localStorage read error for', key, err);
          return fallback;
        }
      }

      // Populate UI from localStorage
      const shopName = getLS('shopName', '').trim();
      const shopAddress = getLS('shopAddress', '').trim();
      const shopPhone = getLS('shopPhone', '').trim();

      shopNameEl.textContent = shopName || 'My Shop';
      shopAddressEl.textContent = shopAddress || 'No Address';
      shopPhoneEl.textContent = (shopPhone ? 'ðŸ“ž ' + shopPhone : 'ðŸ“ž No Phone');

      profileBtn.textContent = (shopName || 'S').charAt(0).toUpperCase();

      // Debug (visible only if you uncomment below)
      // debugEl.style.display = 'block';
      // debugEl.textContent = `shopName="${shopName}" shopAddress="${shopAddress}" shopPhone="${shopPhone}"`;

      // Toggle popup open/close
      function openPopup() {
        profilePopup.classList.add('open');
        profilePopup.setAttribute('aria-hidden', 'false');
      }
      function closePopup() {
        profilePopup.classList.remove('open');
        profilePopup.setAttribute('aria-hidden', 'true');
      }
      function togglePopup() {
        if (profilePopup.classList.contains('open')) closePopup();
        else openPopup();
      }

      profileBtn.addEventListener('click', function (ev) {
        ev.stopPropagation(); // prevent document click handler from immediately closing it
        togglePopup();
      });

      // Close when user clicks outside the popup
      document.addEventListener('click', function (ev) {
        if (!profilePopup.contains(ev.target) && ev.target !== profileBtn) {
          closePopup();
        }
      });

      // Allow ESC to close popup
      document.addEventListener('keydown', function (ev) {
        if (ev.key === 'Escape') closePopup();
      });

      // Buttons
      btnHome.addEventListener('click', function () {
        // keep it simple: go to index
        window.location.href = 'index.html';
      });

      btnLogout.addEventListener('click', function () {
        // Remove shop & customer keys only (less destructive than clear)
        try {
          localStorage.removeItem('shopName');
          localStorage.removeItem('shopAddress');
          localStorage.removeItem('shopPhone');
          localStorage.removeItem('customerName');
          localStorage.removeItem('customerNumber');
        } catch (err) {
          console.error('Error clearing localStorage keys:', err);
        }
        // Redirect to setup page
        window.location.href = 'setup.html';
      });

      // Defensive: if no shopName saved, show small notice in console and keep default values
      if (!shopName) {
        console.info('No shopName found in localStorage â€” profile will show defaults.');
      }

      // Accessibility: stop clicks inside popup from closing it
      profilePopup.addEventListener('click', function (ev) {
        ev.stopPropagation();
      });

      // Expose for debugging (optional)
      window.__profileUi = {
        openPopup,
        closePopup,
        togglePopup
      };
    })();
  </script>

</body>
</html>
